{% extends "base.html" %}

{% block title %}Home{% endblock %}
{% block content %}
<h1 class="text-center mt-3 mb-4">Dashboard</h1>



<!-- Dashboard Overview -->
<div class="dashboard container-fluid py-4">

  <div class="row justify-content-center">

    <!-- Assets by Status -->
    <div class="col-md-5 col-lg-4 mb-4">
      <div class="dashboard-card p-4 shadow-sm">
        <h5 class="text-center mb-3">Assets by Status</h5>
        <canvas id="statusChart" height="300"></canvas>
      </div>
    </div>

    <!-- Assets by Vendor -->
    <div class="col-md-5 col-lg-4 mb-4">
      <div class="dashboard-card p-4 shadow-sm">
        <h5 class="text-center mb-3">Assets by Vendor</h5>
        <canvas id="vendorChart" height="250"></canvas>
      </div>
    </div>

   <!-- Assets by Department -->
    <div class="col-md-5 col-lg-4 mb-4">
      <div class="dashboard-card p-4 shadow-sm">
        <h5 class="text-center mb-3">Assets by Type</h5>
        <canvas id="typeChart" height="250"></canvas>
      </div>
    </div>

  </div>
</div>



<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>



<!-- Dashboard Styles -->
<style>
  body {
    background-color: #f7f9fb;
  }

  .dashboard-card {
    background: white;
    border-radius: 15px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.05);
    transition: transform 0.2s ease, box-shadow 0.2s ease;
  }

  .dashboard-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 20px rgba(0,0,0,0.08);
  }

  h1 {
    font-weight: 600;
    color: #1e3a8a;
  }

  h5 {
    font-weight: 500;
    color: #374151;
  }
</style>



<script>
async function loadStatusChart() {
  const response = await fetch("/chart-data/assets-by-status");
  const data = await response.json();

  const labels = data.map(item => item.status);
  const values = data.map(item => item.count);

  const ctx = document.getElementById('statusChart');
  new Chart(ctx, {
    type: 'bar',
    data: {
      labels: labels,
      datasets: [{
        label: 'Number of Assets',
        data: values,
        backgroundColor: 'rgba(54,235,90,0.6)',
        borderColor: 'rgba(54,235,90,0.75)',
        borderWidth: 1
      }]
    },
    options: {
      scales: { y: { beginAtZero: true } }
    }
  });
}

async function loadVendorChart() {
  const response = await fetch("/chart-data/assets-by-vendor");
  const data = await response.json();

  const labels = data.map(item => item.vendor);
  const values = data.map(item => item.count);

  const ctx = document.getElementById('vendorChart');
  new Chart(ctx, {
    type: 'doughnut',
    data: {
      labels: labels,
      datasets: [{
        label: 'Assets per Vendor',
        data: values,
        backgroundColor: [
          'rgba(245, 99, 255, 0.73)',
          'rgba(54, 162, 235, 0.54)',
          'rgba(255, 206, 86, 0.6)',
          'rgba(75, 192, 192, 0.6)',
          'rgba(153, 102, 255, 0.6)',
          'rgba(255, 159, 64, 0.6)',
          'rgba(99, 255, 132, 0.6)'
        ],
        borderColor: 'rgba(255,255,255,1)',
        borderWidth: 3
      }]
    },
    options: {
        cutout: '60%',
      plugins: {
        legend: { position: 'top' },
        title: {
          display: true,
          text: 'Assets by Vendor'
        }
      }
    }
  });
}



async function loadTypeChart() {
  const response = await fetch("/chart-data/assets-by-type");
  const data = await response.json();

  if (!data.length) {
    document.getElementById('typeChart').replaceWith('No asset type data available');
    return;
  }

  const labels = data.map(item => item.type);
  const values = data.map(item => Number(item.count));

  const ctx = document.getElementById('typeChart');
  new Chart(ctx, {
    type: 'polarArea',
    data: {
      labels: labels,
      datasets: [{
        data: values,
        backgroundColor: [
          'rgba(59,130,246,0.7)',
          'rgba(16,185,129,0.7)',
          'rgba(239,68,68,0.7)',
          'rgba(234,179,8,0.7)',
          'rgba(147,51,234,0.7)'
        ],
        borderColor: '#fff',
        borderWidth: 2
      }]
    },
    options: {
      plugins: {
        legend: { position: 'bottom' },
        title: {
          display: true,
          text: 'Assets by Type'
        }
      }
    }
  });
}



loadStatusChart();
loadVendorChart();
loadTypeChart();
</script>



{% if session['role'] == 'admin' %}
	<h2>Admin Dashboard</h2>
	<p>You can manage all assets and users.</p>

{% elif session['role'] == 'manager' %}
	<h2>Manager Dashboard</h2>
	<p>You can view and assign assets to employees.</p>

{% else %}
	<h2>User Dashboard</h2>
	<p>You can view your assigned assets only.</p>
{% endif %}

<!-- Testing User Perms -->
<ul>
<b>
	<li>Root account : user = root | pw = password</li>
	<li>Manager account : user = manager | pw = password</li>
	<li>User account : user = user | pw = password</li>
</b>
</ul>

{% endblock %}