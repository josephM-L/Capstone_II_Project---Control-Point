{% extends "base.html" %}

{% block title %}Asset Maintenance{% endblock %}

{% block content %}

{% block subnav %}
{% include "subnav.html" %}
{% endblock %}

<h1>Add Maintenance Record</h1>

{% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
    {% for category, msg in messages %}
      <div class="alert alert-{{ category }} mt-2">{{ msg }}</div>
    {% endfor %}
  {% endif %}
{% endwith %}

<form method="post" class="mt-3">
  <div class="mb-3">
    <label for="asset_id" class="form-label">Asset *</label>
    <select id="asset_id" name="asset_id" class="form-control" required>
      {% for asset in assets %}
        <option value="{{ asset.asset_id }}">{{ asset.asset_tag }} - {{ asset.name }}</option>
      {% endfor %}
    </select>
  </div>

  <div class="mb-3">
    <label for="maintenance_date" class="form-label">Maintenance Date *</label>
    <input id="maintenance_date" name="maintenance_date" type="date" class="form-control" required>
  </div>

  <div class="mb-3">
    <label for="description" class="form-label">Description</label>
    <textarea id="description" name="description" class="form-control"></textarea>
  </div>

  <div class="mb-3">
    <label for="performed_by" class="form-label">Performed By</label>
    <input id="performed_by" name="performed_by" class="form-control">
  </div>

  <div class="mb-3">
    <label for="cost" class="form-label">Cost</label>
    <input id="cost" name="cost" type="number" step="0.01" class="form-control">
  </div>

  <div class="mb-3">
    <label for="next_due_date" class="form-label">Next Due Date</label>
    <input id="next_due_date" name="next_due_date" type="date" class="form-control">
  </div>

  <button type="submit" class="btn btn-success">Add Maintenance</button>
</form>

<p></p>

<h2>Existing Maintenance Records</h2>
<table class="table table-striped">
  <thead>
    <tr>
      <th>ID</th>
      <th>Asset</th>
      <th>Date</th>
      <th>Description</th>
      <th>Performed By</th>
      <th>Cost</th>
      <th>Next Due</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody>
    {% for maintenance in maintenances %}
    <tr>
      <td>{{ maintenance.maintenance_id }}</td>
      <td>{{ maintenance.asset.asset_tag }} - {{ maintenance.asset.name }}</td>
      <td>{{ maintenance.maintenance_date }}</td>
      <td>{{ maintenance.description or "" }}</td>
      <td>{{ maintenance.performed_by or "" }}</td>
      <td>{{ maintenance.cost or "" }}</td>
      <td>{{ maintenance.next_due_date or "" }}</td>
      <td>
        <a href="/asset_maintenance/delete/{{ maintenance.maintenance_id }}" class="btn btn-primary ms-2">Delete</a>
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>

{% endblock %}
